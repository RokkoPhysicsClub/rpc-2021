---
title: "ラズパイ・スパコン"
date: 2021-9-7
description: "果たしてこれはスーパコンピュータと呼べるのか。"
image: "./img/k_kiri/raspi-01.jpg"
draft: false
weight: 2
---

<div align="right">80期 k_kiri</div>

## はじめに

タイトル「ラズパイ・スパコン」は明らかに誇張表現だ。先ず謝っておこうと思う。
しかし、スパコンと呼ぶのには理由がある。

このラズパイ・スパコンは、4つのシングルボードコンピュータ・Raspberry Pi（以下、ラズパイ）から構成されており、計16コアのCPUで並列計算をすることが可能だ。
有名なスーパーコンピュータはどれも、たくさんのCPUを並列に動かすことによって莫大な量の計算を高速に実行している。
その仕組みをほんの一部切り取ったのがこのラズパイ・スパコンなのである。
（というのも又誇張だろうか・・・）

## レシピ

### 材料

ラズパイ・スパコンの製作あたって使用した部品リスト

|  名前  |  個数  |
| ---- | ---- |
|  [Raspberry Pi 4 (Model B)](https://akizukidenshi.com/catalog/g/gM-14778/)  |  4  |
|  ヒートシンク |  4セット  |
|  積層式ケース  |  1  |
|  microSDカード  |  4  |
|  LANケーブル  |  4  |
|  usbケーブル (type c)  |  4  |
|  [充電器（電源用）](https://jp.aukey.com/products/63w-5-ports-usb-charger-pa-Y23)  |  1  |
|  スイッチング・ハブ  |  1  |

### Raspberry Pi (ラズパイ)について

ラズパイは、端的に言うと1枚の基盤に載ったパソコンである。
主に教育用として作られたものであるため、パソコンとしては非常に安価であるのが特徴だ。
もちろん、一般的なパソコンに性能は劣るが、インターネットを閲覧したり、動画を再生したり、一般的な用途にも幅広く活用できる。

ラズパイのもう一つの特徴はGPIOピンが搭載されていることだ。ラズパイ・スパコンでは利用していないが、電子工作などで活用できる。

### ソフトウェアなど

現時点では、OpenMPIを用いた並列計算が可能。

### 性能
- CPU: Broadcom BCM2711, quad-core Cortex-A72 (ARM v8) 64-bit SoC
- RAM: 合計10GB（4GB + 2GB ✕ 3）
- OS: RaspberryPi OS

### 大まかな手順
1. 組み立てる。
1. Masterノード[^1]とSlaveノードに、OpenMPIなどの開発環境をインストール。
1. IPアドレスを固定する。
1. hostsファイルを編集してIPアドレスとホスト名を対応させ、いちいちIPアドレスを指定する手間を削減。
1. SSH接続のためにMasterノードで認証鍵を生成し、Slaveノードに転送する。
1. keychainを使って認証を省略できるように設定。
1. Masterノード上にマウント可能な共有ディレクトリを作る。
1. Slaveノードが自動で共有ディレクトリをマウントするように設定。
1. `mpiexec`と`-H`オプションで、OpenMPIを使って書いた並列計算プログラムが実行できる。

## 実際に試す

HelloWorldの代わりに16個全てのコアからメッセージを送った。
![helloworld](./../../img/k_kiri/raspi-02.png)
円周率を求めるプログラムと、スパコン体験塾で製作した素数ゼミシミュレーション[^2]を並列化してラズパイ・スパコン上で走らせてみた。
文化祭当日は計算中のラズパイを展示する予定だ。
4つの基盤と文字が流れる黒い画面が並べられた地味な光景になることは疑いようもない。（後日その時の写真をここに貼ろうと思う。）

## 写真
製作途中の写真。
![製作中の写真](./../../img/k_kiri/raspi-01.jpg)

## 苦労

ネットワークの設定に苦労した。部室からインターネットに接続するためには学校のプロキシサーバーを経由しなければならない。又、複数のラズパイを一度の設定で接続できるようにIPアドレスを固定しなければならない。これらの2つを両立できなかった。
結局、インターネットに接続することはできないまま、ソフトウェアは自宅でインストールすることになった。
完全にネットワークに関する自分の知識不足である。
しかし、この経験を通して少しネットワークに関する知識とLinuxに関する知識は深まったと思う。この知識がどこで役に立つかはまだわからないが。

## あとがき
このラズパイ・スパコンは趣味の産物だ。実用性はほとんどない。単純な計算力で比較するとIntel core iシリーズや、AMD Ryzenシリーズの１つのCPUに及ばないだろう。しかし、自分でラズパイを連携させて並列計算させることは面白いし、ロマンのある研究（工作？）になったと思う。
後悔があるとすれば、4ノードでは少なかったことだ。16ノードくらいほしいところだが、特に使い道も無くLinuxとOpenMPIによる並列計算の学習にしか使えないものなので4ノード程度で丁度良かったのかもしれない。

最後に、この研究のために期間限定で学校のIPアドレスを４つ固定してくださった技術科のN先生の協力に多大なる感謝を申し上げる。

## 参考文献

1. Carlos R. Morrison, (齊藤 哲哉 訳), [Raspberry Piでスーパーコンピュータをつくろう!](https://www.amazon.co.jp/dp/4320124375), 共立出版, 2018/8/24
1. [計算工学ナビ-RaspberryPiクラスタ製作記](http://www.cenav.org/raspi2/), 2021/9/03閲覧


[^1]:参考文献[1]に倣い、他のノードの管理を行うノードをMaster、計算のみ行うノードをSlaveノードと呼ぶ
[^2]:[こちら](../spacon-taikenjuku)の記事を参照